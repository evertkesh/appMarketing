<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{complementoPagina/header :: head}">
    <title>Nueva Reunión - Marketing Pro</title>
</head>
<body>
    <div th:replace="~{complementoPagina/header :: header}"></div>
    
    <div class="container-fluid">
        <div class="row">
            <div th:replace="~{complementoPagina/sidebar :: sidebar}"></div>
            
            <main class="main-content col-md-10 p-4">
                <a th:href="@{/admin/reuniones}" class="btn btn-outline-secondary mb-3">
                    <i class="bi bi-arrow-left"></i> Volver
                </a>
                
                <h2 class="fw-bold mb-4">Crear Nueva Reunión</h2>
                
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-4">
                        <form th:action="@{/admin/reuniones/organizar}" th:object="${reunion}" method="post">
                            <div class="row g-3">
                                
                                <!-- Título -->
                                <div class="col-12">
                                    <label class="form-label fw-bold">Título <span class="text-danger">*</span></label>
                                    <input type="text" th:field="*{titulo}" class="form-control" required placeholder="Nombre de la reunión">
                                </div>
                                
                                <!-- Fecha y Hora -->
                                <div class="col-md-6">
                                    <label class="form-label fw-bold">Fecha y Hora <span class="text-danger">*</span></label>
                                    <input type="datetime-local" th:field="*{fechaHora}" class="form-control" required>
                                </div>
                                
                                <!-- Lugar -->
                                <div class="col-md-6">
                                    <label class="form-label fw-bold">Lugar <span class="text-danger">*</span></label>
                                    <input type="text" th:field="*{lugar}" class="form-control" required placeholder="Ej: Sala A, Zoom">
                                </div>
                                
                                <!-- Descripción -->
                                <div class="col-12">
                                    <label class="form-label fw-bold">Descripción</label>
                                    <textarea th:field="*{descripcion}" class="form-control" rows="3" placeholder="Detalles de la reunión..."></textarea>
                                </div>
                                
                                <!-- Equipo -->
                                <div class="col-md-6">
                                    <label class="form-label fw-bold">Equipo <span class="text-danger">*</span></label>
                                    <select name="equipoId" class="form-select" required>
                                        <option value="">-- Seleccionar --</option>
                                        <option th:if="${equipos != null}" th:each="equipo : ${equipos}" th:value="${equipo.id}" th:text="${equipo.nombre}"></option>
                                    </select>
                                </div>
                                
                                <!-- Organizador (oculto) -->
                                <div class="col-md-6">
                                    <label class="form-label fw-bold">Organizador</label>
                                    <input type="text" id="organizadorDisplay" class="form-control" disabled>
                                    <input type="hidden" name="organizadorId" id="organizadorId" value="1">
                                </div>
                                
                                <!-- Notificar -->
                                <div class="col-12">
                                    <div class="form-check">
                                        <input type="checkbox" th:field="*{notificarJefe}" class="form-check-input" id="notificar">
                                        <label class="form-check-label" for="notificar">Notificar al jefe del equipo</label>
                                    </div>
                                </div>
                                
                                <!-- Botones -->
                                <div class="col-12 pt-2">
                                    <button type="submit" class="btn btn-success"><i class="bi bi-check-circle"></i> Guardar</button>
                                    <a th:href="@{/admin/reuniones}" class="btn btn-secondary">Cancelar</a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/api/usuario/actual')
                .then(response => response.json())
                .then(data => {
                    if (data && data.id) {
                        document.getElementById('organizadorId').value = data.id;
                        document.getElementById('organizadorDisplay').value = data.nombreCompleto || data.nombre;
                    }
                })
                .catch(error => console.log('Error obteniendo usuario'));
        });
    </script>
</body>
</html>